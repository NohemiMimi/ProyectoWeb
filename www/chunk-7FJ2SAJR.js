import{a as U}from"./chunk-YR6A7VV2.js";import"./chunk-TDENHI5R.js";import{a as q}from"./chunk-RVMZQ23V.js";import"./chunk-ACNLDH3S.js";import"./chunk-FMV3DWDN.js";import"./chunk-WND7HVWL.js";import"./chunk-KL7HTKAB.js";import"./chunk-HC6MZPB3.js";import"./chunk-JKUOXI3A.js";import"./chunk-426OJ4HC.js";import"./chunk-B24TMA6E.js";import"./chunk-OHRAIMKX.js";import"./chunk-MM5QLNJM.js";import"./chunk-H3GX5QFY.js";import"./chunk-7D6K5XYM.js";import"./chunk-OBXDPQ3V.js";import"./chunk-NCPUF6OX.js";import"./chunk-MCRJI3T3.js";import"./chunk-KHGZ5KYX.js";import"./chunk-QXZDNAG7.js";import{$a as A,A as s,Ba as G,C as i,D as o,E as v,I as w,J as f,K as b,R as d,S as y,T as O,U as h,V as _,W as x,Ya as H,Z as k,Za as z,_a as j,aa as I,ab as L,ba as S,bb as W,ca as T,cb as V,ea as E,fb as R,gb as B,jb as J,l as C,m as M,s as r,t as m,ua as D,v as P,va as N,y as p,za as F}from"./chunk-A7TVLPBO.js";import"./chunk-4H3EC2BX.js";import"./chunk-7KGURMOZ.js";import"./chunk-WAPQ3BUF.js";import"./chunk-3RVCS4YC.js";import"./chunk-ZNWVC66N.js";import"./chunk-G3CV3VGG.js";import"./chunk-LBGEUR6J.js";import"./chunk-HAXAEEDB.js";import"./chunk-3SG6N7GV.js";import"./chunk-4WFVMWDK.js";import"./chunk-4I6HJA6T.js";import"./chunk-NMYJD6OP.js";import"./chunk-B43CU5JX.js";import"./chunk-TQEIIVVC.js";import"./chunk-LF5XB4YN.js";import{e as u}from"./chunk-JHI3MBHO.js";var K=a=>({selected:a});function Q(a,g){if(a&1&&(i(0,"span"),d(1),o()),a&2){let e=b().$implicit;r(),y(e.nombre)}}function X(a,g){a&1&&(i(0,"span"),d(1,"\u2714"),o())}function Y(a,g){if(a&1){let e=w();i(0,"button",14),f("click",function(){let n=C(e).index,l=b();return M(l.toggleDia(n))}),p(1,Q,2,1,"span",15)(2,X,2,0,"span",15),o()}if(a&2){let e=g.$implicit;s("ngClass",k(3,K,e.seleccionado)),r(),s("ngIf",!e.seleccionado),r(),s("ngIf",e.seleccionado)}}var re=(()=>{class a{constructor(e,t,n){this.alertController=e,this.navCtrl=t,this.authService=n,this.dias=[{nombre:"L",seleccionado:!1},{nombre:"Ma",seleccionado:!1},{nombre:"Mi",seleccionado:!1},{nombre:"J",seleccionado:!1},{nombre:"V",seleccionado:!1},{nombre:"S",seleccionado:!1},{nombre:"D",seleccionado:!1}],this.abrir="08:00",this.cerrar="08:00",this.humedad=null,this.isGuardadoDisabled=!1}ngOnInit(){this.obtenerHumedad(),this.humedadInterval=setInterval(()=>{this.obtenerHumedad()},5e3)}ngOnDestroy(){this.humedadInterval&&clearInterval(this.humedadInterval)}obtenerHumedad(){this.authService.getHumedad().subscribe(e=>{this.humedad=e.humedad,console.log("Humedad obtenida en Tab2:",this.humedad),this.checkHumedad()},e=>{console.error("Error obteniendo la humedad en Tab2:",e)})}checkHumedad(){this.humedad!==null&&(console.log("Humedad actual:",this.humedad),this.humedad>=50&&!this.isGuardadoDisabled?(this.isGuardadoDisabled=!0,this.mostrarNotificacion("La humedad es alta. No es necesario programar el riego.","danger")):this.humedad<50&&this.isGuardadoDisabled&&(this.isGuardadoDisabled=!1,this.mostrarNotificacion("La humedad ha bajado. Ahora puedes programar el riego.","success")))}toggleDia(e){this.dias[e].seleccionado=!this.dias[e].seleccionado}guardarSeleccion(){return u(this,null,function*(){if(this.humedad!==null&&this.humedad>=50){this.isGuardadoDisabled=!0,yield this.mostrarNotificacion("La humedad es alta. No es necesario programar el riego.","danger");return}else this.isGuardadoDisabled=!1;let e=this.dias.filter(t=>t.seleccionado).map(t=>t.nombre);if(!this.abrir||!this.cerrar||e.length===0){yield this.mostrarNotificacion("Por favor, complete todos los campos.","warning");return}try{yield this.authService.programarRiego(this.abrir,this.cerrar,e).toPromise(),yield this.mostrarNotificacion("Riego programado exitosamente.","success"),this.navCtrl.navigateForward("/tabs/tab1")}catch(t){console.error("Error al programar el riego:",t),yield this.mostrarNotificacion("Ocurri\xF3 un error al programar el riego.","danger")}})}mostrarNotificacion(e,t){return u(this,null,function*(){yield(yield this.alertController.create({header:t==="success"?"\xC9xito":t==="danger"?"Error":"Advertencia",message:e,buttons:["Aceptar"]})).present()})}static{this.\u0275fac=function(t){return new(t||a)(m(U),m(G),m(q))}}static{this.\u0275cmp=P({type:a,selectors:[["app-tab2"]],decls:35,vars:7,consts:[[3,"translucent"],[3,"fullscreen"],[1,"label"],[1,"ion-align-items-center"],["size","12",1,"aspersor","ion-text-center"],["size","12",1,"ion-text-center"],["presentation","time",1,"compact-time",3,"ngModelChange","ngModel"],["size","12",1,"ion-text-left"],[1,"ion-padding-top"],["size","12",1,"riego","ion-text-center"],[1,"dias-container"],["class","semana",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"ion-text-center","ion-padding-top"],[1,"guardar",3,"click","disabled"],[1,"semana",3,"click","ngClass"],[4,"ngIf"]],template:function(t,n){t&1&&(i(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),d(3,"Programar aspersor"),o()()(),i(4,"ion-content",1),v(5,"br")(6,"br"),i(7,"ion-item",2)(8,"ion-label"),d(9),o()(),i(10,"ion-grid")(11,"ion-row",3)(12,"ion-col",4)(13,"p"),d(14,"Abrir:"),o()(),i(15,"ion-col",5)(16,"ion-datetime",6),x("ngModelChange",function(c){return _(n.abrir,c)||(n.abrir=c),c}),o()()()(),i(17,"ion-grid")(18,"ion-row",3)(19,"ion-col",4)(20,"p"),d(21,"Cerrar:"),o()(),i(22,"ion-col",7)(23,"ion-datetime",6),x("ngModelChange",function(c){return _(n.cerrar,c)||(n.cerrar=c),c}),o()()()(),i(24,"ion-grid",8)(25,"ion-row")(26,"ion-col",9)(27,"p"),d(28,"Programar riego semanal"),o()()()(),i(29,"div",10),p(30,Y,3,5,"button",11),o(),i(31,"div",12)(32,"button",13),f("click",function(){return n.guardarSeleccion()}),i(33,"p"),d(34,"Guardar"),o()()()()),t&2&&(s("translucent",!0),r(4),s("fullscreen",!0),r(5),O("Humedad actual: ",n.humedad!==null?n.humedad+"%":"--",""),r(7),h("ngModel",n.abrir),r(7),h("ngModel",n.cerrar),r(7),s("ngForOf",n.dias),r(2),s("disabled",n.isGuardadoDisabled))},dependencies:[E,I,S,T,F,D,N,A,B,R,z,j,V,H,J,L,W],styles:['@charset "UTF-8";ion-toolbar[_ngcontent-%COMP%]{--background: #4CAF50;--color: white;text-align:center}ion-content[_ngcontent-%COMP%]{--background: #C8E6C9;display:flex;justify-content:center;align-items:center;height:100vh;padding:0 16px}ion-grid[_ngcontent-%COMP%]{width:100%;max-width:400px;display:flex;flex-direction:column;justify-content:center;align-items:center}ion-row[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-start;margin-bottom:15px}.aspersor[_ngcontent-%COMP%], .riego[_ngcontent-%COMP%]{font-size:20px;text-align:left;flex:1;margin-right:15px;text-align:center}.datetime-btn[_ngcontent-%COMP%]{background-color:#fff;color:#000;border-radius:5px;padding:10px;width:auto;min-width:120px;text-align:center;flex-shrink:0}ion-datetime-button[_ngcontent-%COMP%]::part(native){background-color:#fff!important;color:#000!important;border-radius:5px;padding:5px 20px}.dias-container[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:8px}.semana[_ngcontent-%COMP%]{background-color:#fff;color:#000;border-radius:5px;padding:10px;font-size:18px}.semana[_ngcontent-%COMP%]:hover{background-color:#81c784;color:#fff}.semana.selected[_ngcontent-%COMP%]{background-color:#4caf50;color:#fff;font-weight:700}.guardar[_ngcontent-%COMP%]{background-color:#4caf50;color:#fff;border-radius:5px;padding:0 90px;font-size:15px;display:block;margin:20px auto}.guardar[_ngcontent-%COMP%]:disabled{background-color:#bdbdbd;cursor:not-allowed}.guardar[_ngcontent-%COMP%]:disabled:hover{background-color:#bdbdbd}.guardar[_ngcontent-%COMP%]:hover{background-color:#388e3c}.notification[_ngcontent-%COMP%]{position:fixed;top:10px;left:50%;transform:translate(-50%);background-color:#000000b3;color:#fff;padding:15px;border-radius:8px;font-size:14px;max-width:90%;text-align:center;z-index:9999;opacity:0}.notification.success[_ngcontent-%COMP%]{background-color:green}.notification.danger[_ngcontent-%COMP%]{background-color:red}.notification.warning[_ngcontent-%COMP%]{background-color:orange}.label[_ngcontent-%COMP%]{width:50%;border-radius:5px;text-align:center;margin:0 auto}']})}}return a})();export{re as Tab2Page};
